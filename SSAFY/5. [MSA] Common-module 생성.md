# ğŸš€ [ììœ¨ í”„ë¡œì íŠ¸] MSA ê³µí†µ ëª¨ë“ˆ êµ¬í˜„ ë° ì ìš© ê°€ì´ë“œ

## ğŸ“‹ ëª©í‘œ

- MSA í™˜ê²½ì—ì„œ ê° ì„œë¹„ìŠ¤ ê°„ **ê³µí†µ ì½”ë“œ ì¬ì‚¬ìš©**
- í‘œì¤€í™”ëœ ì˜ˆì™¸ ì²˜ë¦¬ ë° ì‘ë‹µ í˜•ì‹ ì ìš©
- ë…ë¦½ì ì¸ ì„œë¹„ìŠ¤ êµ¬ì¡° ìœ ì§€í•˜ë©´ì„œ ì½”ë“œ ì¤‘ë³µ ìµœì†Œí™”

---

## ğŸ§± 1. ê³µí†µ ëª¨ë“ˆ ì„¤ê³„ ë° êµ¬ì¡°

### ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
common-module/
â”œâ”€â”€ build.gradle
â””â”€â”€ src/
    â””â”€â”€ main/
        â”œâ”€â”€ java/
        â”‚   â””â”€â”€ com/
        â”‚       â””â”€â”€ s206/
        â”‚           â””â”€â”€ common/
        â”‚               â”œâ”€â”€ dto/
        â”‚               â”‚   â””â”€â”€ ResponseDto.java
        â”‚               â”œâ”€â”€ exception/
        â”‚               â”‚   â”œâ”€â”€ CustomException.java
        â”‚               â”‚   â”œâ”€â”€ GlobalExceptionHandler.java
        â”‚               â”‚   â””â”€â”€ types/
        â”‚               â”‚       â”œâ”€â”€ BadRequestException.java
        â”‚               â”‚       â”œâ”€â”€ NotFoundException.java
        â”‚               â”‚       â”œâ”€â”€ UnauthorizedException.java
        â”‚               â”‚       â”œâ”€â”€ ConflictException.java
        â”‚               â”‚       â”œâ”€â”€ AiCallFailedException.java
        â”‚               â”‚       â”œâ”€â”€ ValidationException.java
        â”‚               â”‚       â”œâ”€â”€ WebClientCommunicationException.java
        â”‚               â”‚       â””â”€â”€ ... (ê¸°íƒ€ ì˜ˆì™¸ í´ë˜ìŠ¤)
        â”‚               â””â”€â”€ util/
        â”‚                   â””â”€â”€ ... (ê³µí†µ ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤)
        â””â”€â”€ resources/
            â””â”€â”€ ... (í•„ìš”ì‹œ ê³µí†µ ë¦¬ì†ŒìŠ¤ íŒŒì¼)

```

### âš™ï¸ ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸ ì„¤ì •

**build.gradle**:

```
plugins {
    id 'java-library'
    id 'org.springframework.boot' version '3.2.5'
    id 'io.spring.dependency-management' version '1.1.7'
}

group = 'com.s206'
version = '0.0.1-SNAPSHOT'

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(17)
    }
}

// ì‹¤í–‰ ê°€ëŠ¥í•œ JARê°€ ì•„ë‹Œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ì„¤ì •
bootJar {
    enabled = false
}

jar {
    enabled = true
}

configurations {
    compileOnly {
        extendsFrom annotationProcessor
    }
}

repositories {
    mavenCentral()
}

dependencies {
    // ì›¹ ê´€ë ¨ ì˜ì¡´ì„±
    implementation 'org.springframework.boot:spring-boot-starter-web'

    // ìœ íš¨ì„± ê²€ì‚¬
    implementation 'org.springframework.boot:spring-boot-starter-validation'

    // WebClient í†µì‹ 
    implementation 'org.springframework.boot:spring-boot-starter-webflux'

    // Lombok
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'

    // í…ŒìŠ¤íŠ¸
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
}

tasks.named('test') {
    useJUnitPlatform()
}

```

---

## ğŸ“ 2. ì£¼ìš” ê³µí†µ í´ë˜ìŠ¤ êµ¬í˜„

### ğŸ“Š ì‘ë‹µ DTO

**ResponseDto.java**:

```java
package com.s206.common.dto;

import lombok.Getter;
import lombok.NoArgsConstructor;

@Getter
@NoArgsConstructor
public class ResponseDto<T> {
    private boolean success;
    private T data;
    private ErrorInfo error;

    @Getter
    @NoArgsConstructor
    static class ErrorInfo {
        private int code;
        private String message;

        public ErrorInfo(int code, String message) {
            this.code = code;
            this.message = message;
        }
    }

    // ì„±ê³µ ì‘ë‹µ ìƒì„±
    public static <T> ResponseDto<T> success(T data) {
        ResponseDto<T> response = new ResponseDto<>();
        response.success = true;
        response.data = data;
        return response;
    }

    // ì˜¤ë¥˜ ì‘ë‹µ ìƒì„±
    public static <T> ResponseDto<T> error(int code, String message) {
        ResponseDto<T> response = new ResponseDto<>();
        response.success = false;
        response.error = new ErrorInfo(code, message);
        return response;
    }
}

```

### ğŸ›‘ ì»¤ìŠ¤í…€ ì˜ˆì™¸ ë² ì´ìŠ¤ í´ë˜ìŠ¤

**CustomException.java**:

```java
package com.s206.common.exception;

import lombok.Getter;
import org.springframework.http.HttpStatus;

@Getter
public class CustomException extends RuntimeException {
    private final int statusCode;

    public CustomException(String message, HttpStatus status) {
        super(message);
        this.statusCode = status.value();
    }

    public CustomException(String message, int statusCode) {
        super(message);
        this.statusCode = statusCode;
    }
}

```

### ğŸ§© ê°œë³„ ì˜ˆì™¸ í´ë˜ìŠ¤ (ì˜ˆì‹œ)

**NotFoundException.java**:

```java
package com.s206.common.exception.types;

import com.s206.common.exception.CustomException;
import org.springframework.http.HttpStatus;

public class NotFoundException extends CustomException {
    public NotFoundException(String message) {
        super(message, HttpStatus.NOT_FOUND);
    }
}

```

### ğŸŒ ì „ì—­ ì˜ˆì™¸ ì²˜ë¦¬ê¸°

**GlobalExceptionHandler.java**:

```java
package com.s206.common.exception;

import com.s206.common.dto.ResponseDto;
import com.s206.common.exception.types.*;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.MethodArgumentNotValidException;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestControllerAdvice;

/**
 * ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì—­ì˜ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” í•¸ë“¤ëŸ¬
 */
@RestControllerAdvice
public class GlobalExceptionHandler {

    // 400 Bad Request
    @ExceptionHandler(BadRequestException.class)
    public ResponseEntity<ResponseDto<Void>> handleBadRequest(BadRequestException ex) {
        return ResponseEntity.status(HttpStatus.BAD_REQUEST)
                .body(ResponseDto.error(HttpStatus.BAD_REQUEST.value(), ex.getMessage()));
    }

    // 404 Not Found
    @ExceptionHandler(NotFoundException.class)
    public ResponseEntity<ResponseDto<Void>> handleNotFound(NotFoundException ex) {
        return ResponseEntity.status(HttpStatus.NOT_FOUND)
                .body(ResponseDto.error(HttpStatus.NOT_FOUND.value(), ex.getMessage()));
    }

    // ë‚˜ë¨¸ì§€ ì˜ˆì™¸ ì²˜ë¦¬ê¸° (ìƒëµ)...

    // ì¼ë°˜ ì˜ˆì™¸ ì²˜ë¦¬
    @ExceptionHandler(Exception.class)
    public ResponseEntity<ResponseDto<Void>> handleGenericException(Exception e) {
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                .body(ResponseDto.error(HttpStatus.INTERNAL_SERVER_ERROR.value(), "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."));
    }
}

```

---

## ğŸ”¨ 3. ë¹Œë“œ ë° ë°°í¬

### ğŸ“¦ ë¹Œë“œ ê³¼ì •

1. ê³µí†µ ëª¨ë“ˆ ë””ë ‰í† ë¦¬ë¡œ ì´ë™:

```bash
cd common-module

```

1. Gradle ë¹Œë“œ ì‹¤í–‰:

```bash
./gradlew clean build

```

1. í™•ì¸: `build/libs/common-module-0.0.1-SNAPSHOT.jar` íŒŒì¼ ìƒì„±

### ğŸ”„ ë²„ì „ ê´€ë¦¬ (ì„ íƒ ì‚¬í•­)

- ì¤‘ìš”í•œ ë³€ê²½ì´ ìˆì„ ë•Œë§ˆë‹¤ `version = '0.0.1-SNAPSHOT'` â†’ `version = '0.0.2-SNAPSHOT'` ë“±ìœ¼ë¡œ ë²„ì „ ë³€ê²½
- ë³€ê²½ ë‚´ì—­ì„ CHANGELOG.md íŒŒì¼ì— ê¸°ë¡

---

## ğŸ”Œ 4. ê°œë³„ ì„œë¹„ìŠ¤ì— ê³µí†µ ëª¨ë“ˆ ì ìš©

### ğŸ“‹ ì˜ì¡´ì„± ì¶”ê°€

ê° ì„œë¹„ìŠ¤ì˜ `build.gradle` íŒŒì¼ì— ê³µí†µ ëª¨ë“ˆ JAR ì°¸ì¡° ì¶”ê°€:

```
dependencies {
    // ê¸°ì¡´ ì˜ì¡´ì„±...

    // ê³µí†µ ëª¨ë“ˆ ì°¸ì¡° (ìƒëŒ€ ê²½ë¡œ ì‚¬ìš©)
    implementation files('../common-module/build/libs/common-module-0.0.1-SNAPSHOT.jar')

    // ë˜ëŠ” ì ˆëŒ€ ê²½ë¡œ ì‚¬ìš©
    // implementation files('/path/to/common-module/build/libs/common-module-0.0.1-SNAPSHOT.jar')
}

```

### ğŸ”„ íŒ¨í‚¤ì§€ ìŠ¤ìº” ì„¤ì • ì¶”ê°€

ê° ì„œë¹„ìŠ¤ì˜ ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ í´ë˜ìŠ¤ì— ê³µí†µ ëª¨ë“ˆ íŒ¨í‚¤ì§€ ìŠ¤ìº” ì„¤ì • ì¶”ê°€:

```java
@SpringBootApplication
@ComponentScan(basePackages = {"com.yourservice", "com.s206.common"})
public class YourServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(YourServiceApplication.class, args);
    }
}

```

### ğŸ’¡ ê³µí†µ í´ë˜ìŠ¤ ì‚¬ìš© ì˜ˆì‹œ

**ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì‚¬ìš©**:

```java
@RestController
@RequestMapping("/api/auth")
public class AuthController {

    @PostMapping("/login")
    public ResponseEntity<ResponseDto<LoginResponse>> login(@RequestBody LoginRequest request) {
        try {
            LoginResponse response = authService.login(request);
            return ResponseEntity.ok(ResponseDto.success(response));
        } catch (UnauthorizedException e) {
            // GlobalExceptionHandlerì—ì„œ ìë™ìœ¼ë¡œ ì²˜ë¦¬ë¨
            throw e;
        }
    }
}

```

**ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©**:

```java
@Service
public class UserService {

    public User getUserById(Long id) {
        return userRepository.findById(id)
            .orElseThrow(() -> new NotFoundException("ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: " + id));
    }
}

```

---

## ğŸ“Š 5. ì¥ì  vs ë‹¨ì  ë¶„ì„

### âœ… ì¥ì 

- **ì½”ë“œ ì¬ì‚¬ìš©**: ë™ì¼í•œ ì½”ë“œë¥¼ ì—¬ëŸ¬ ì„œë¹„ìŠ¤ì—ì„œ ë°˜ë³µ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ë¨
- **ì¼ê´€ì„± ìœ ì§€**: ëª¨ë“  ì„œë¹„ìŠ¤ì—ì„œ ë™ì¼í•œ ì‘ë‹µ í˜•ì‹ê³¼ ì˜ˆì™¸ ì²˜ë¦¬ ë°©ì‹ ì ìš©
- **ìœ ì§€ë³´ìˆ˜ ìš©ì´**: ê³µí†µ ì½”ë“œ ë³€ê²½ ì‹œ í•œ ê³³ë§Œ ìˆ˜ì •í•˜ë©´ ëª¨ë“  ì„œë¹„ìŠ¤ì— ì ìš©
- **ê°œë°œ ì†ë„ í–¥ìƒ**: ê¸°ë³¸ ê¸°ëŠ¥ êµ¬í˜„ ì‹œê°„ ë‹¨ì¶•

### âš ï¸ ë‹¨ì 

- **ì˜ì¡´ì„± ê´€ë¦¬ ë³µì¡ì„±**: ê³µí†µ ëª¨ë“ˆ ë³€ê²½ ì‹œ ë§¤ë²ˆ ì¬ë¹Œë“œ í•„ìš”
- **IDE ì§€ì› ì œí•œ**: íŒŒì¼ ì°¸ì¡° ë°©ì‹ì€ ì½”ë“œ ìë™ ì™„ì„±ì´ë‚˜ íƒìƒ‰ ê¸°ëŠ¥ì— ì œí•œ
- **ë²„ì „ ê´€ë¦¬ ì–´ë ¤ì›€**: ê³µí†µ ëª¨ë“ˆ ë²„ì „ ê´€ë¦¬ ë° í˜¸í™˜ì„± í™•ì¸ í•„ìš”

---

## ğŸ” 6. ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ (FAQ)

### Q: ê³µí†µ ëª¨ë“ˆì„ ìˆ˜ì •í•œ í›„ ì–´ë–»ê²Œ ì ìš©í•˜ë‚˜ìš”?

A: ê³µí†µ ëª¨ë“ˆì„ ìˆ˜ì •í•œ í›„ì—ëŠ” ë‹¤ì‹œ ë¹Œë“œí•˜ì—¬ JAR íŒŒì¼ì„ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤:

```bash
cd common-module
./gradlew clean build

```

ê·¸ í›„ ê° ì„œë¹„ìŠ¤ë¥¼ ì¬ì‹œì‘í•˜ë©´ ìƒˆë¡œìš´ ê³µí†µ ëª¨ë“ˆì´ ì ìš©ë©ë‹ˆë‹¤.

Gradle ë¹Œë“œ ì‹œ ìƒì„±ëœ íŒŒì¼ë“¤ì„ ì‚­ì œí•˜ë ¤ë©´ `clean` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤:

```bash

bash
$ ./gradlew clean

```

ì´ ëª…ë ¹ì–´ëŠ” `build` ë””ë ‰í† ë¦¬ì™€ ê·¸ ì•ˆì— ìˆëŠ” ëª¨ë“  íŒŒì¼(ì»´íŒŒì¼ëœ í´ë˜ìŠ¤ íŒŒì¼, JAR íŒŒì¼ ë“±)ì„ ì‚­ì œí•©ë‹ˆë‹¤.

### Q: ê³µí†µ ëª¨ë“ˆì´ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šê²Œ í•˜ë ¤ë©´?

A: ê³µí†µ ëª¨ë“ˆì€ í´ë˜ìŠ¤ ì„¤ê³„ ì‹œ ê° ì„œë¹„ìŠ¤ì˜ ë…ë¦½ì„±ì„ í•´ì¹˜ì§€ ì•Šë„ë¡ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤. íŠ¹íˆ `@Component`, `@Service` ë“±ì˜ ì• ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•  ë•ŒëŠ” ëª…í™•í•œ ì‹ë³„ìë¥¼ ë¶€ì—¬í•˜ê³ , í•„ìš”í•œ ê²½ìš° ì¡°ê±´ë¶€ ë¹ˆ ë“±ë¡ì„ ê³ ë ¤í•˜ì„¸ìš”.

### Q: ë©€í‹° ëª¨ë“ˆ ë°©ì‹ì´ ë” ë‚˜ì€ ê²½ìš°ëŠ”?

A: í”„ë¡œì íŠ¸ ê·œëª¨ê°€ ì»¤ì§€ê³  ê³µí†µ ëª¨ë“ˆì˜ ë³µì¡ë„ê°€ ë†’ì•„ì§€ë©´ Gradle/Maven ë©€í‹° ëª¨ë“ˆ ë°©ì‹ì„ ê³ ë ¤í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ì´ëŠ” IDE í†µí•©, ì˜ì¡´ì„± ê´€ë¦¬, ë¹Œë“œ ìë™í™” ì¸¡ë©´ì—ì„œ ë” ë‚˜ì€ ê°œë°œ ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤.

---

## ğŸ“ˆ 7. ê°œì„  ë° ë°œì „ ë°©í–¥

### ğŸ”„ í–¥í›„ ê°œì„  ì‚¬í•­

1. **ë©”ì´ë¸ ë¡œì»¬ ë¦¬í¬ì§€í† ë¦¬ í™œìš©**: JAR íŒŒì¼ ì§ì ‘ ì°¸ì¡° ëŒ€ì‹  ë¡œì»¬ Maven ë¦¬í¬ì§€í† ë¦¬ ê²Œì‹œ
2. **í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ í–¥ìƒ**: ê³µí†µ ëª¨ë“ˆì— ëŒ€í•œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ë° í†µí•© í…ŒìŠ¤íŠ¸ ì¶”ê°€
3. **ì¡°ê±´ë¶€ ìë™ êµ¬ì„±**: `@ConditionalOn...` ì• ë…¸í…Œì´ì…˜ì„ í™œìš©í•œ ìœ ì—°í•œ ê³µí†µ ê¸°ëŠ¥ ì œê³µ
4. **ë¬¸ì„œí™”**: ê³µí†µ ëª¨ë“ˆ ì‚¬ìš© ê°€ì´ë“œ ë° API ë¬¸ì„œ ì‘ì„±

### ğŸ“š ê´€ë ¨ ì°¸ê³  ìë£Œ

- [Spring Boot Reference Documentation](https://docs.spring.io/spring-boot/docs/current/reference/html/)
- [Spring Frameworkì˜ ì˜ˆì™¸ ì²˜ë¦¬](https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-ann-exceptionhandler)
- [Gradle ì‚¬ìš©ì ê°€ì´ë“œ](https://docs.gradle.org/current/userguide/userguide.html)

---

## ğŸ‘¨â€ğŸ’» 8. ì‹¤ì œ êµ¬í˜„ ì‚¬ë¡€

### ê³µí†µ ì˜ˆì™¸ ê³„ì¸µ êµ¬ì¡°

```
CustomException (ê¸°ë³¸ ì˜ˆì™¸ í´ë˜ìŠ¤)
â”œâ”€â”€ BadRequestException (400)
â”œâ”€â”€ UnauthorizedException (401)
â”œâ”€â”€ ForbiddenException (403)
â”œâ”€â”€ NotFoundException (404)
â”œâ”€â”€ ConflictException (409)
â”‚   â””â”€â”€ AlreadyExistsException (409 - ë¦¬ì†ŒìŠ¤ ì¤‘ë³µ)
â”œâ”€â”€ UnsupportedMediaTypeException (415)
â”œâ”€â”€ TooManyRequestsException (429)
â”œâ”€â”€ InternalServerException (500)
â”‚   â””â”€â”€ AiCallFailedException (500 - AI í˜¸ì¶œ ì‹¤íŒ¨)
â””â”€â”€ WebClientCommunicationException (502)

```

### í‘œì¤€ ì‘ë‹µ í˜•ì‹

**ì„±ê³µ ì‘ë‹µ**:

```json
{
  "success": true,
  "data": { ... },
  "error": null
}

```

**ì˜¤ë¥˜ ì‘ë‹µ**:

```json
{
  "success": false,
  "data": null,
  "error": {
    "code": 404,
    "message": "ìš”ì²­í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
  }
}

```

---

## ğŸ 9. ê²°ë¡ 

MSA í™˜ê²½ì—ì„œ ê³µí†µ ëª¨ë“ˆì„ JAR í˜•íƒœë¡œ ë¶„ë¦¬í•˜ì—¬ í™œìš©í•˜ëŠ” ë°©ì‹ì€ ë¹ ë¥¸ ê°œë°œê³¼ ì½”ë“œ ì¬ì‚¬ìš©ì„± ì¸¡ë©´ì—ì„œ ë§ì€ ì´ì ì„ ì œê³µí•©ë‹ˆë‹¤. í˜„ì¬ í”„ë¡œì íŠ¸ ê·œëª¨ì™€ ìš”êµ¬ì‚¬í•­ì— ë§ê²Œ ì„¤ê³„ëœ ì´ ë°©ì‹ì€ ê° ì„œë¹„ìŠ¤ì˜ ë…ë¦½ì„±ì„ ìœ ì§€í•˜ë©´ì„œë„ í‘œì¤€í™”ëœ ì½”ë“œ ê¸°ë°˜ì„ ì œê³µí•©ë‹ˆë‹¤.

ì•ìœ¼ë¡œ í”„ë¡œì íŠ¸ê°€ ì„±ì¥í•¨ì— ë”°ë¼ ë” ì²´ê³„ì ì¸ ëª¨ë“ˆ ê´€ë¦¬ ë°©ì‹ìœ¼ë¡œ ë°œì „ì‹œí‚¬ ìˆ˜ ìˆìœ¼ë©°, í˜„ì¬ êµ¬í˜„ëœ ê³µí†µ ëª¨ë“ˆì€ ê·¸ ê¸°ë°˜ì´ ë  ê²ƒì…ë‹ˆë‹¤.

**ë‹¤ìŒ ë‹¨ê³„ë¡œ, ì´ ê°€ì´ë“œë¥¼ ì°¸ê³ í•˜ì—¬ ì‹¤ì œ ì„œë¹„ìŠ¤ì— ê³µí†µ ëª¨ë“ˆì„ ì ìš©í•˜ê³  í”¼ë“œë°±ì„ í†µí•´ ì§€ì†ì ìœ¼ë¡œ ê°œì„ í•´ ë‚˜ê°€ì„¸ìš”!**